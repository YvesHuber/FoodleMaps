<!DOCTYPE html>
<html> 
<title>Foodle</title>
<head>
    <link rel="stylesheet" href="Maps.css"> 
      <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4LoCAFYz3qASC-yq1m5jrbtfx6So1eeQ&libraries=places&v=weekly"
        defer
      ></script>
</head>
<body>
    <div id="map"></div>

    <form id="back">
        <input type="button" id="BackButton" value="Go back" onclick="history.back()"></input>
    </form>
    <form id="Searchbarform">
        <input type="text" id ="Searchbar" placeholder="Search for Place" value="" id="DCo" size="50">
        <button id="SearchButton" type="submit">Search</button>
    </form>
    <form id="SelectMap">
        <select id="SelectType">
            <option value="roadmap">Roadmap</option>
            <option value="satellite">Satellite</option>
            <option value="hybrid">Hybrid</option>
            <option value="terrain">Terrain</option>
        </select>
        <button  id="SelectButton" type="submit">Select</button>
    </form>
        <form id=RandomButtonForm>
            <button id = "RandomButton" type="submit">Take Me Anyweare!</button>
        </form>
    <script>
 
    let map;
    let infoWindow;
    let service;
    let marker;
    let mapinitchecker = false;
    let target;

    function loadMapatstart(){
        target = new google.maps.LatLng(0, 0);
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 1, 
            center: target, 
            gestureHandling: 'greedy',
            mapTypeId: document.getElementById('MapType').value
        });
        mapinitchecker = true;
        map.setOptions({minZoom: 3, maxZoom: 15});
        var marker = new google.maps.Marker({position: target, map: map});
    }

    function ConvertDMSToDEG(dms) {   
        var dms_Array = dms.split(/[^\d\w\.]+/); 
        var degreesNS = dms_Array[0];
        var minutesNS = dms_Array[1];
        var secondsNS = dms_Array[2];
        var directionNS = dms_Array[3];
        var degreesEW = dms_Array[4];
        var minutesEW = dms_Array[5];
        var secondsEW = dms_Array[6];
        var directionEW = dms_Array[7];

        var deg = [];
        var degNS = (Number(degreesNS) + Number(minutesNS) /60 + Number(secondsNS) / 3600).toFixed(6);
        var degEW = (Number(degreesEW) + Number(minutesEW) /60 + Number(secondsEW) / 3600).toFixed(6);

        if (directionNS == "S" || directionNS == "W") {
            degNS = degNS * -1;
        }
        if (directionEW == "S" || directionEW == "W") {
            degEW = degEW * -1;
        }
        if(directionNS != "S" && directionNS != "W" && directionNS != "N" && directionNS != "E" && directionNS != "O"){
            degNS = dms_Array[0];
        }
        if(directionEW != "S" && directionEW != "W" && directionEW != "N" && directionEW != "E" && directionEW != "O"){
            degEW = dms_Array[1];
        }
        deg[0] = degNS;
        deg[1] = degEW;
        return deg;
    }

    document.getElementById("SearchButton").onclick = function (evt) {
        input = document.getElementById("Searchbar").value;
        latlng = [];
        latlng = ConvertDMSToDEG(input);
        lat = latlng[0];
        lng = latlng[1];
        console.log(lat + ";"+ lng);
        target = new google.maps.LatLng(lat, lng);
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10, 
            center: target, 
            gestureHandling: 'greedy',
            mapTypeId: document.getElementById('SelectType').value
        });
        mapinitchecker = true;
        map.setOptions({minZoom: 3, maxZoom: 15});
        var marker = new google.maps.Marker({position: target, map: map});
        evt.preventDefault();
    }
    
    document.getElementById("SelectButton").onclick = function (evt) {
        if(mapinitchecker == true){
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10, 
                center: target, 
                gestureHandling: 'greedy',
                mapTypeId: document.getElementById('SelectType').value
            });
            mapinitchecker = true;
            map.setOptions({minZoom: 3, maxZoom: 15});
            var marker = new google.maps.Marker({position: target, map: map});
            evt.preventDefault();
        }
        else{
            console.log("Map isnt init");
        }
        evt.preventDefault();
    }
    
    document.getElementById("RandomButton").onclick = function (evt) { 	
        maxminheight = 85;
        maxminwidth = 180;
        lng = Math.random() * (maxminwidth - maxminwidth * (-1)) + maxminwidth * (-1);
        lat = Math.random() * (maxminheight - maxminheight * (-1)) + maxminheight * (-1);
        target = new google.maps.LatLng(lat, lng);
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 13, 
            center: target, 
            gestureHandling: 'greedy',
            
        });
        mapinitchecker = true;
        map.setOptions({minZoom: 3, maxZoom: 15});
        var marker = new google.maps.Marker({position: target, map: map});
        infoWindow = new google.maps.InfoWindow();
        infoWindow.setPosition(target);
        infoWindow.setContent("Random Position: " + lat + ", " + lng);
        infoWindow.open(map);
        evt.preventDefault();
    }
    </script>
</body>
</html>
